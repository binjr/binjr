id: eu.binjr.binjr
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.openjdk25
command: binjr
finish-args:
  - --socket=x11
  - --share=ipc
  - --device=dri
  - --share=network
  - --filesystem=host
modules:
  - name: binjr
    buildsystem: simple
    build-commands:
      - source /usr/lib/sdk/openjdk25/enable.sh && export JFX_JMOD_PATH='jfx/jmods'; export REPO_TAG_NAME=${tagName}; export IS_TAG=true; export USE_BUILD_JDK_IN_BUNDLE=true; gradle clean jpackageLinuxFlatpak --offline --stacktrace
      - cp -ar build/flatpak/binjr/* /app/
      - install -Dm644 distribution/bundlers/linux_fpk/icons/binjr_16.png /app/share/icons/hicolor/16x16/apps/eu.binjr.binjr.png
      - install -Dm644 distribution/bundlers/linux_fpk/icons/binjr_32.png /app/share/icons/hicolor/32x32/apps/eu.binjr.binjr.png
      - install -Dm644 distribution/bundlers/linux_fpk/icons/binjr_48.png /app/share/icons/hicolor/48x48/apps/eu.binjr.binjr.png
      - install -Dm644 distribution/bundlers/linux_fpk/icons/binjr_64.png /app/share/icons/hicolor/64x64/apps/eu.binjr.binjr.png
      - install -Dm644 distribution/bundlers/linux_fpk/icons/binjr_128.png /app/share/icons/hicolor/128x128/apps/eu.binjr.binjr.png
      - install -Dm644 distribution/bundlers/linux_fpk/icons/binjr_256.png /app/share/icons/hicolor/256x256/apps/eu.binjr.binjr.png
      - install -Dm644 distribution/bundlers/linux_fpk/icons/binjr_512.png /app/share/icons/hicolor/512x512/apps/eu.binjr.binjr.png
      - install -Dm644 build/tmp/expanded/eu.binjr.binjr.metainfo.xml /app/share/metainfo/eu.binjr.binjr.metainfo.xml
      - install -Dm644 distribution/bundlers/linux_fpk/metadata/eu.binjr.binjr.mime.xml /app/share/mime/packages/eu.binjr.binjr.mime.xml
      - install -Dm644 distribution/bundlers/linux_fpk/metadata/eu.binjr.binjr.desktop -t /app/share/applications
    sources:
      - type: git
        url: https://github.com/binjr/binjr.git
        tag: ${tagName}
      - type: archive
        url: ${jfxJmodUrl_x64}
        sha256: ${jfxJmodSha_x64}
        strip-components: 1
        dest: "jfx/jmods/"
        only-arches:
        - x86_64
      - type: archive
        url: ${jfxJmodUrl_aarch64}
        sha256: ${jfxJmodSha_aarch64}
        strip-components: 1
        dest: "jfx/jmods/"
        only-arches:
        - aarch64
      - type: file
        url: https://repo.maven.apache.org/maven2/io/netty/netty-bom/4.1.130.Final/netty-bom-4.1.130.Final.pom
        sha512: cb4a8b3fc9419b3d9c1d829a4abed446034dc0ca56c75ff6dfaf4d03809e89087bea619c7451f6a666119b1256391c59f82b0a60d22609d35b6d15acc1dcf8bf
        dest: ./offline-repository/io/netty/netty-bom/4.1.130.Final
      - bom-gradle-plugins.json
      - bom-binjr-app-linux-x86_64.json
      - bom-binjr-app-linux-aarch64.json

